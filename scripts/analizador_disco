#Este es un script para cuando el disco duro se peta...
#Para busquedas manuales puedes usar el siguiente comando...
#       sudo du -h --max-depth=1 /
# donde / lo sustituyes por la carpeta donde inspeccionas, y el maxdepth por la
# profundidad de escaneo en directorio.
#
#
# Con esto tendría en cuenta todos los ficheros desde 100MB en adelante.
# grep -e '[0-9]G\>' -e "[1-9][0-9][0-9]M\>"



printf "\nANALIZANDO USO DEL DISCO...\n\n"
printf "\n||||||ANALIZADOR DE USO DE DISCO DE ALEX||||||\n\n" >resultado_analisis.txt
df -Th | grep -v "fs" | sort >> resultado_analisis.txt 2> /dev/null
printf "\n."
printf "\n>>>>CARPETAS DE MAS DE 1 GB....\n\n" >> resultado_analisis.txt
sudo du -h --max-depth=6 / | grep '[0-9]G\>' | grep -v 'DESCARGAS' | grep -v '/home/*' >> resultado_analisis.txt 2> /dev/null
printf "\n."
printf "\n>>>>FICHEROS DE MAS DE 100MB...\n\n" >> resultado_analisis.txt
sudo find / -name '*' -size +100M | grep -v 'DESCARGAS' | grep -v 'GDRIVE' >> resultado_analisis.txt 2> /dev/null
printf "\n."
printf "\n>>>>FICHEROS BASURA...\n\n" >> resultado_analisis.txt
sudo find / -type d -name '*Trash*' | sudo xargs du -h | sort >> resultado_analisis.txt 2> /dev/null
printf "\n."
printf "\n>>>>FICHEROS .DEB EN CACHE PARA BORRAR....\n" >> resultado_analisis.txt
sudo du -h /var/cache/apt/ >> resultado_analisis.txt 2> /dev/null
printf "\n."
printf "\n>>>>FICHEROS .LOG BORRABLES....\n\n" >> resultado_analisis.txt
sudo du -h /var/log >> resultado_analisis.txt 2> /dev/null
printf "\n."
printf "\n>>>>COMPRUEBA SI HAY FICHEROS EN LA PAPELERA DE RECICLAJE...\n\n" >> resultado_analisis.txt
sudo find / -type d -name '*Trash*' | sudo xargs du -h | sort >> resultado_analisis.txt 2> /dev/null
printf "\n\n>>>>VAMOS A VER CADA USUARIO CUANTO OCUPA EN DISCO DURO...\n    (FICHEROS Y CARPETAS DE MAS DE 1GB)\n" >> resultado_analisis.txt

LIMITE=$(ls -1 /home/ | grep -v 'lost+found' |  wc -l)

for ((i=1; i <= LIMITE ; i++))
do
#nombre=$(cat /etc/passwd | cut -d":" -f1 | sed -n "$i"p)
nombre=$(ls -1 /home/ | grep -v 'lost+found' | sed -n "$i"p)
printf "\n -----USUARIO $nombre---------\n\n" >> resultado_analisis.txt
sudo find /home/$nombre/* -maxdepth 1 -user $nombre -print0 | sudo xargs -0 du --max-depth=0 -h | sort | grep '[0-9]G\>' >> resultado_analisis.txt 2> /dev/null
printf "\n."
done



printf "\nCOMPROBACIÓN FINALIZADA...\n\nTODOS LOS RESULTADOS HAN SIDO ALMACENADOS EN RESULTADOS_ANALISIS.TXT\nPOR FAVOR COMPRUEBE EL FICHERO...\n"